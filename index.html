<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wadowice Airport - System ZarzƒÖdzania</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
        }

        .header .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        .nav-tabs {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-btn {
            padding: 15px 30px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1em;
            border-radius: 8px;
            transition: all 0.3s;
            color: #666;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: #f0f2f5;
        }

        .tab-btn.active {
            background: #1e3c72;
            color: white;
        }

        .content-panel {
            display: none;
        }

        .content-panel.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.9em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #1e3c72;
            color: white;
        }

        .btn-primary:hover {
            background: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .boarding-pass {
            background: white;
            border: 3px solid #1e3c72;
            border-radius: 15px;
            padding: 0;
            max-width: 800px;
            margin: 30px auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .bp-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .bp-header h2 {
            margin: 0;
            font-size: 1.8em;
            color: white;
        }

        .bp-header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }

        .bp-body {
            padding: 30px;
        }

        .bp-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px dashed #e0e0e0;
        }

        .bp-field {
            margin-bottom: 15px;
        }

        .bp-field label {
            display: block;
            font-size: 0.75em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .bp-field .value {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .bp-large {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .bp-large .seat {
            font-size: 3em;
            font-weight: bold;
            color: #1e3c72;
        }

        .bp-barcode {
            text-align: center;
            padding: 20px;
            background: white;
            margin-top: 20px;
        }

        .barcode-img {
            width: 100%;
            max-width: 400px;
            height: 80px;
            background: linear-gradient(90deg, 
                #000 0%, #000 8%, transparent 8%, transparent 12%,
                #000 12%, #000 16%, transparent 16%, transparent 20%,
                #000 20%, #000 24%, transparent 24%, transparent 28%,
                #000 28%, #000 36%, transparent 36%, transparent 40%,
                #000 40%, #000 44%, transparent 44%, transparent 48%,
                #000 48%, #000 56%, transparent 56%, transparent 60%,
                #000 60%, #000 64%, transparent 64%, transparent 68%,
                #000 68%, #000 72%, transparent 72%, transparent 76%,
                #000 76%, #000 84%, transparent 84%, transparent 88%,
                #000 88%, #000 92%, transparent 92%, transparent 96%,
                #000 96%, #000 100%);
            margin: 0 auto 10px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            display: block;
        }

        .barcode-text {
            font-family: monospace;
            font-size: 1.2em;
            letter-spacing: 3px;
            color: #333;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
        }

        .stat-card .label {
            color: #666;
            margin-top: 10px;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .boarding-pass, .boarding-pass * {
                visibility: visible;
            }
            .boarding-pass {
                position: absolute;
                left: 0;
                top: 0;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .scan-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: successPulse 0.5s ease-out;
        }

        .scan-error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: errorShake 0.5s ease-out;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .passenger-details {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 3px solid #28a745;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚úàÔ∏è Wadowice Airport - System ZarzƒÖdzania</h1>
        <div class="user-info">
            <span>üë§ Pracownik Lotniska</span>
        </div>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchTab('flights')">‚úàÔ∏è ZarzƒÖdzanie Lotami</button>
            <button class="tab-btn" onclick="switchTab('reservations')">üìã Rezerwacje</button>
            <button class="tab-btn" onclick="switchTab('checkin')">‚úÖ Odprawa</button>
            <button class="tab-btn" onclick="switchTab('boarding')">üé´ Wpuszczanie na Pok≈Çad</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="content-panel active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="number" id="totalFlights">0</div>
                    <div class="label">Dzisiejsze loty</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="totalReservations">0</div>
                    <div class="label">Rezerwacje</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="checkedInCount">0</div>
                    <div class="label">Odprawieni</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="waitingCount">0</div>
                    <div class="label">Oczekuje na odprawƒô</div>
                </div>
            </div>

            <div class="card">
                <h2>Dzisiejsze Loty</h2>
                <div id="todayFlightsList"></div>
            </div>
        </div>

        <!-- ZARZƒÑDZANIE LOTAMI -->
        <div id="flights" class="content-panel">
            <div class="card">
                <h2>Dodaj Nowy Lot</h2>
                <form id="addFlightForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Numer Lotu *</label>
                            <input type="text" id="flightNumber" placeholder="WA101" required>
                        </div>
                        <div class="form-group">
                            <label>Linia Lotnicza *</label>
                            <input type="text" id="airline" placeholder="Wadowice Airlines" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Lotnisko Wylotu *</label>
                            <input type="text" id="departureAirport" placeholder="Wadowice (WAD)" required>
                        </div>
                        <div class="form-group">
                            <label>Lotnisko Przylotu *</label>
                            <input type="text" id="arrivalAirport" placeholder="np. Warszawa (WAW)" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Data Lotu *</label>
                            <input type="date" id="flightDate" required>
                        </div>
                        <div class="form-group">
                            <label>Godzina Wylotu *</label>
                            <input type="time" id="departureTime" required>
                        </div>
                        <div class="form-group">
                            <label>Godzina Przylotu *</label>
                            <input type="time" id="arrivalTime" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Bramka</label>
                            <input type="text" id="gate" placeholder="B5">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="flightStatus">
                                <option value="scheduled">Zaplanowany</option>
                                <option value="boarding">Boarding</option>
                                <option value="delayed">Op√≥≈∫niony</option>
                                <option value="cancelled">Odwo≈Çany</option>
                                <option value="departed">Wylecia≈Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Maksymalna liczba miejsc</label>
                            <input type="number" id="maxSeats" value="180" min="1">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">‚ûï Dodaj Lot</button>
                </form>
            </div>

            <div class="card">
                <h2>Lista Lot√≥w</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nr Lotu</th>
                            <th>Trasa</th>
                            <th>Data</th>
                            <th>Wylot</th>
                            <th>Bramka</th>
                            <th>Status</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="flightsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- REZERWACJE -->
        <div id="reservations" class="content-panel">
            <div class="card">
                <h2>Dodaj Rezerwacjƒô</h2>
                <form id="addReservationForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Wybierz Lot *</label>
                            <select id="reservationFlight" required>
                                <option value="">Wybierz lot</option>
                            </select>
                        </div>
                    </div>

                    <h3 style="margin: 20px 0;">Dane Pasa≈ºera</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Imiƒô *</label>
                            <input type="text" id="passengerFirstName" required>
                        </div>
                        <div class="form-group">
                            <label>Nazwisko *</label>
                            <input type="text" id="passengerLastName" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Data Urodzenia *</label>
                            <input type="date" id="passengerBirthDate" required>
                        </div>
                        <div class="form-group">
                            <label>Numer Dokumentu *</label>
                            <input type="text" id="passengerDocNumber" placeholder="ABC123456" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="passengerEmail">
                        </div>
                        <div class="form-group">
                            <label>Telefon</label>
                            <input type="tel" id="passengerPhone">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Uwagi</label>
                        <textarea id="reservationNotes" rows="3"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">‚ûï Dodaj Rezerwacjƒô</button>
                </form>
            </div>

            <div class="card">
                <h2>Lista Rezerwacji</h2>
                <div class="search-box">
                    <input type="text" id="searchReservation" placeholder="üîç Szukaj po nazwisku, numerze rezerwacji lub locie..." oninput="filterReservations()">
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nr Rezerwacji</th>
                            <th>Pasa≈ºer</th>
                            <th>Lot</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="reservationsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ODPRAWA -->
        <div id="checkin" class="content-panel">
            <div class="card">
                <h2>Wyszukaj Rezerwacjƒô do Odprawy</h2>
                <div class="search-box">
                    <input type="text" id="searchCheckin" placeholder="üîç Wprowad≈∫ nazwisko lub numer rezerwacji..." oninput="searchForCheckin()">
                </div>
                <div id="checkinSearchResults"></div>
            </div>

            <div id="checkinFormContainer" style="display: none;">
                <div class="card">
                    <h2>Odprawa Pasa≈ºera</h2>
                    <div id="checkinPassengerInfo"></div>
                    
                    <form id="checkinForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Wybierz Miejsce *</label>
                                <select id="seatSelection" required></select>
                            </div>
                            <div class="form-group">
                                <label>Baga≈º Rejestrowany (kg)</label>
                                <input type="number" id="luggageWeight" value="0" min="0" max="32">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Dodatkowe Uwagi</label>
                            <textarea id="checkinNotes" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-success">‚úÖ Zatwierd≈∫ Odprawƒô i Wygeneruj Kartƒô Pok≈ÇadowƒÖ</button>
                    </form>
                </div>
            </div>

            <div id="boardingPassContainer" style="display: none;"></div>
        </div>

        <!-- WPUSZCZANIE NA POK≈ÅAD -->
        <div id="boarding" class="content-panel">
            <div class="card">
                <h2>üé´ Skanowanie Kart Pok≈Çadowych - Bramka</h2>
                <p style="color:#666; margin-bottom:20px;">Wprowad≈∫ kod QR z karty pok≈Çadowej lub zeskanuj go skanerem kod√≥w kreskowych</p>
                
                <div class="form-group">
                    <label>Kod QR / Numer Karty Pok≈Çadowej</label>
                    <input type="text" id="qrCodeInput" placeholder="Wprowad≈∫ kod lub u≈ºyj skanera..." style="font-size:1.2em; padding:15px;">
                </div>

                <button class="btn btn-primary" onclick="scanBoardingPass()" style="width:100%; font-size:1.2em; padding:15px;">
                    üîç Skanuj Kartƒô Pok≈ÇadowƒÖ
                </button>
            </div>

            <div id="scanResult" style="display:none;"></div>
        </div>
    </div>

    <!-- Modal Edycji Lotu -->
    <div id="editFlightModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edytuj Lot</h2>
                <button class="modal-close" onclick="closeEditFlightModal()">√ó</button>
            </div>
            <form id="editFlightForm">
                <input type="hidden" id="editFlightId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Numer Lotu</label>
                        <input type="text" id="editFlightNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editFlightStatus">
                            <option value="scheduled">Zaplanowany</option>
                            <option value="boarding">Boarding</option>
                            <option value="delayed">Op√≥≈∫niony</option>
                            <option value="cancelled">Odwo≈Çany</option>
                            <option value="departed">Wylecia≈Ç</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Bramka</label>
                    <input type="text" id="editGate">
                </div>
                <button type="submit" class="btn btn-primary">Zapisz Zmiany</button>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // Dane aplikacji
        let flights = [];
        let reservations = [];
        let currentCheckinReservation = null;

        // Inicjalizacja
        function init() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('flightDate').value = today;
            document.getElementById('flightDate').min = today;
            updateDashboard();
            renderFlightsTable();
            renderReservationsTable();
            updateFlightSelects();
        }

        // Prze≈ÇƒÖczanie zak≈Çadek
        function switchTab(tabName) {
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'boarding') {
                document.getElementById('qrCodeInput').focus();
            }
        }

        // Dashboard
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayFlights = flights.filter(f => f.date === today);
            const checkedIn = reservations.filter(r => r.checkedIn).length;
            const waiting = reservations.filter(r => !r.checkedIn).length;

            document.getElementById('totalFlights').textContent = todayFlights.length;
            document.getElementById('totalReservations').textContent = reservations.length;
            document.getElementById('checkedInCount').textContent = checkedIn;
            document.getElementById('waitingCount').textContent = waiting;

            const flightsList = document.getElementById('todayFlightsList');
            if (todayFlights.length === 0) {
                flightsList.innerHTML = '<p style="text-align:center; color:#666; padding:20px;">Brak lot√≥w na dzisiaj</p>';
            } else {
                let html = '<table class="table"><thead><tr><th>Nr Lotu</th><th>Trasa</th><th>Wylot</th><th>Bramka</th><th>Status</th></tr></thead><tbody>';
                todayFlights.forEach(flight => {
                    html += `
                        <tr>
                            <td><strong>${flight.number}</strong></td>
                            <td>${flight.departure} ‚Üí ${flight.arrival}</td>
                            <td>${flight.departureTime}</td>
                            <td>${flight.gate || '-'}</td>
                            <td>${getStatusBadge(flight.status)}</td>
                        </tr>
                    `;
                });
                html += '</tbody></table>';
                flightsList.innerHTML = html;
            }
        }

        // ZarzƒÖdzanie lotami
        const addFlightForm = document.getElementById('addFlightForm');
        if (addFlightForm) {
            addFlightForm.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('Formularz wys≈Çany!');
                
                const flightNumber = document.getElementById('flightNumber').value.trim();
                const airline = document.getElementById('airline').value.trim();
                const departureAirport = document.getElementById('departureAirport').value.trim();
                const arrivalAirport = document.getElementById('arrivalAirport').value.trim();
                const flightDate = document.getElementById('flightDate').value;
                const departureTime = document.getElementById('departureTime').value;
                const arrivalTime = document.getElementById('arrivalTime').value;
                
                // Walidacja
                if (!flightNumber || !airline || !departureAirport || !arrivalAirport || !flightDate || !departureTime || !arrivalTime) {
                    showNotification('‚ö†Ô∏è Wype≈Çnij wszystkie wymagane pola!', 'error');
                    return;
                }
                
                const flight = {
                    id: 'FL' + Date.now(),
                    number: flightNumber,
                    airline: airline,
                    departure: departureAirport,
                    arrival: arrivalAirport,
                    date: flightDate,
                    departureTime: departureTime,
                    arrivalTime: arrivalTime,
                    gate: document.getElementById('gate').value.trim(),
                    status: document.getElementById('flightStatus').value,
                    maxSeats: parseInt(document.getElementById('maxSeats').value) || 180,
                    createdAt: new Date().toISOString()
                };

                console.log('Dodajƒô lot:', flight);
                flights.push(flight);
                console.log('Wszystkie loty:', flights);
                
                this.reset();
                
                // Resetuj datƒô do dzisiejszej
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('flightDate').value = today;
                
                renderFlightsTable();
                updateFlightSelects();
                updateDashboard();
                
                // Poka≈º komunikat
                showNotification('‚úÖ Lot ' + flight.number + ' zosta≈Ç dodany pomy≈õlnie!', 'success');
                
                // Przewi≈Ñ do tabeli
                setTimeout(() => {
                    const flightsCard = document.querySelector('#flights .card:last-child');
                    if (flightsCard) {
                        flightsCard.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            });
        } else {
            console.error('Nie znaleziono formularza addFlightForm!');
        }

        function renderFlightsTable() {
            const tbody = document.getElementById('flightsTableBody');
            
            if (flights.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:30px; color:#666;">Brak lot√≥w w systemie. Dodaj pierwszy lot.</td></tr>';
                return;
            }

            tbody.innerHTML = flights.map(flight => `
                <tr>
                    <td><strong>${flight.number}</strong><br><small>${flight.airline}</small></td>
                    <td>${flight.departure}<br>‚Üí ${flight.arrival}</td>
                    <td>${formatDate(flight.date)}</td>
                    <td>${flight.departureTime}</td>
                    <td>${flight.gate || '-'}</td>
                    <td>${getStatusBadge(flight.status)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="editFlight('${flight.id}')" style="padding:8px 15px;">Edytuj</button>
                            <button class="btn btn-danger" onclick="deleteFlight('${flight.id}')" style="padding:8px 15px;">Usu≈Ñ</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function editFlight(flightId) {
            const flight = flights.find(f => f.id === flightId);
            if (!flight) return;

            document.getElementById('editFlightId').value = flight.id;
            document.getElementById('editFlightNumber').value = flight.number;
            document.getElementById('editFlightStatus').value = flight.status;
            document.getElementById('editGate').value = flight.gate;
            
            document.getElementById('editFlightModal').classList.add('active');
        }

        function closeEditFlightModal() {
            document.getElementById('editFlightModal').classList.remove('active');
        }

        document.getElementById('editFlightForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const flightId = document.getElementById('editFlightId').value;
            const flight = flights.find(f => f.id === flightId);
            
            if (flight) {
                flight.number = document.getElementById('editFlightNumber').value;
                flight.status = document.getElementById('editFlightStatus').value;
                flight.gate = document.getElementById('editGate').value;
                
                renderFlightsTable();
                updateFlightSelects();
                updateDashboard();
                closeEditFlightModal();
                showNotification('‚úÖ Lot zosta≈Ç zaktualizowany!', 'success');
            }
        });

        function deleteFlight(flightId) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá ten lot?')) {
                flights = flights.filter(f => f.id !== flightId);
                renderFlightsTable();
                updateFlightSelects();
                updateDashboard();
                showNotification('‚úÖ Lot zosta≈Ç usuniƒôty!', 'success');
            }
        }

        // ZarzƒÖdzanie rezerwacjami
        function updateFlightSelects() {
            const select = document.getElementById('reservationFlight');
            select.innerHTML = '<option value="">Wybierz lot</option>';
            
            flights.forEach(flight => {
                select.innerHTML += `
                    <option value="${flight.id}">
                        ${flight.number} - ${flight.departure} ‚Üí ${flight.arrival} (${formatDate(flight.date)} ${flight.departureTime})
                    </option>
                `;
            });
        }

        document.getElementById('addReservationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const flightId = document.getElementById('reservationFlight').value;
            const flight = flights.find(f => f.id === flightId);
            
            if (!flight) {
                alert('Wybierz lot!');
                return;
            }

            const reservation = {
                id: 'RES' + Date.now(),
                flightId: flightId,
                passenger: {
                    firstName: document.getElementById('passengerFirstName').value,
                    lastName: document.getElementById('passengerLastName').value,
                    birthDate: document.getElementById('passengerBirthDate').value,
                    documentNumber: document.getElementById('passengerDocNumber').value,
                    email: document.getElementById('passengerEmail').value,
                    phone: document.getElementById('passengerPhone').value
                },
                notes: document.getElementById('reservationNotes').value,
                checkedIn: false,
                createdAt: new Date().toISOString()
            };

            reservations.push(reservation);
            this.reset();
            renderReservationsTable();
            updateDashboard();
            showNotification('‚úÖ Rezerwacja ' + reservation.id + ' zosta≈Ça dodana pomy≈õlnie!', 'success');
        });

        function renderReservationsTable() {
            const tbody = document.getElementById('reservationsTableBody');
            
            if (reservations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px; color:#666;">Brak rezerwacji w systemie.</td></tr>';
                return;
            }

            tbody.innerHTML = reservations.map(res => {
                const flight = flights.find(f => f.id === res.flightId);
                const statusBadge = res.checkedIn ? 
                    '<span class="badge badge-success">‚úÖ Odprawiony</span>' : 
                    '<span class="badge badge-warning">‚è≥ Oczekuje</span>';

                return `
                    <tr>
                        <td><strong>${res.id}</strong></td>
                        <td>${res.passenger.firstName} ${res.passenger.lastName}<br>
                            <small>Dok: ${res.passenger.documentNumber}</small></td>
                        <td>${flight ? flight.number : 'N/A'}<br>
                            <small>${flight ? flight.departure + ' ‚Üí ' + flight.arrival : ''}</small></td>
                        <td>${flight ? formatDate(flight.date) + ' ' + flight.departureTime : 'N/A'}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteReservation('${res.id}')" style="padding:8px 15px;">Usu≈Ñ</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterReservations() {
            const search = document.getElementById('searchReservation').value.toLowerCase();
            const tbody = document.getElementById('reservationsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function deleteReservation(resId) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá tƒô rezerwacjƒô?')) {
                reservations = reservations.filter(r => r.id !== resId);
                renderReservationsTable();
                updateDashboard();
                showNotification('‚úÖ Rezerwacja zosta≈Ça usuniƒôta!', 'success');
            }
        }

        // Odprawa
        function searchForCheckin() {
            const search = document.getElementById('searchCheckin').value.toLowerCase();
            const results = document.getElementById('checkinSearchResults');
            
            if (search.length < 2) {
                results.innerHTML = '';
                return;
            }

            const found = reservations.filter(r => 
                r.passenger.lastName.toLowerCase().includes(search) ||
                r.passenger.firstName.toLowerCase().includes(search) ||
                r.id.toLowerCase().includes(search)
            );

            if (found.length === 0) {
                results.innerHTML = '<p style="text-align:center; color:#666; padding:20px;">Nie znaleziono rezerwacji</p>';
                return;
            }

            results.innerHTML = found.map(res => {
                const flight = flights.find(f => f.id === res.flightId);
                const statusBadge = res.checkedIn ? 
                    '<span class="badge badge-success">‚úÖ Odprawiony</span>' : 
                    '<span class="badge badge-warning">‚è≥ Oczekuje</span>';

                return `
                    <div class="card" style="cursor:pointer; margin-bottom:15px;" onclick="selectForCheckin('${res.id}')">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <h3>${res.passenger.firstName} ${res.passenger.lastName}</h3>
                                <p>Nr rezerwacji: ${res.id}</p>
                                <p>Lot: ${flight ? flight.number : 'N/A'} - ${flight ? flight.departure + ' ‚Üí ' + flight.arrival : ''}</p>
                                <p>Data: ${flight ? formatDate(flight.date) + ' ' + flight.departureTime : 'N/A'}</p>
                            </div>
                            <div>${statusBadge}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectForCheckin(resId) {
            const reservation = reservations.find(r => r.id === resId);
            if (!reservation) return;

            currentCheckinReservation = reservation;
            const flight = flights.find(f => f.id === reservation.flightId);

            document.getElementById('checkinPassengerInfo').innerHTML = `
                <div style="background:#f8f9fa; padding:20px; border-radius:8px; margin-bottom:20px;">
                    <h3>Informacje o Pasa≈ºerze</h3>
                    <p><strong>Imiƒô i Nazwisko:</strong> ${reservation.passenger.firstName} ${reservation.passenger.lastName}</p>
                    <p><strong>Data Urodzenia:</strong> ${formatDate(reservation.passenger.birthDate)}</p>
                    <p><strong>Nr Dokumentu:</strong> ${reservation.passenger.documentNumber}</p>
                    <p><strong>Email:</strong> ${reservation.passenger.email || 'Brak'}</p>
                    <p><strong>Telefon:</strong> ${reservation.passenger.phone || 'Brak'}</p>
                    <hr>
                    <h3>Informacje o Locie</h3>
                    <p><strong>Lot:</strong> ${flight.number} (${flight.airline})</p>
                    <p><strong>Trasa:</strong> ${flight.departure} ‚Üí ${flight.arrival}</p>
                    <p><strong>Data:</strong> ${formatDate(flight.date)}</p>
                    <p><strong>Wylot:</strong> ${flight.departureTime}</p>
                    <p><strong>Bramka:</strong> ${flight.gate || 'Nie przypisana'}</p>
                </div>
            `;

            // Generuj dostƒôpne miejsca
            const seatSelect = document.getElementById('seatSelection');
            seatSelect.innerHTML = '';
            const rows = ['A', 'B', 'C', 'D', 'E', 'F'];
            for (let i = 1; i <= 30; i++) {
                rows.forEach(row => {
                    seatSelect.innerHTML += `<option value="${i}${row}">${i}${row}</option>`;
                });
            }

            document.getElementById('checkinFormContainer').style.display = 'block';
            document.getElementById('boardingPassContainer').style.display = 'none';
        }

        document.getElementById('checkinForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (!currentCheckinReservation) return;

            const seat = document.getElementById('seatSelection').value;
            const luggage = document.getElementById('luggageWeight').value;
            const notes = document.getElementById('checkinNotes').value;

            currentCheckinReservation.checkedIn = true;
            currentCheckinReservation.checkInData = {
                seat: seat,
                luggage: luggage,
                notes: notes,
                checkInTime: new Date().toISOString(),
                boardingPass: 'BP' + Date.now()
            };

            generateBoardingPass(currentCheckinReservation);
            renderReservationsTable();
            updateDashboard();
        });

        function generateBoardingPass(reservation) {
            const flight = flights.find(f => f.id === reservation.flightId);
            const boardingTime = new Date(flight.date + ' ' + flight.departureTime);
            boardingTime.setMinutes(boardingTime.getMinutes() - 30);

            const container = document.getElementById('boardingPassContainer');
            container.innerHTML = `
                <div class="boarding-pass">
                    <div class="bp-header">
                        <h2>‚úàÔ∏è KARTA POK≈ÅADOWA</h2>
                        <p>Wadowice Airport</p>
                    </div>
                    <div class="bp-body">
                        <div class="bp-section">
                            <div>
                                <div class="bp-field">
                                    <label>Pasa≈ºer</label>
                                    <div class="value">${reservation.passenger.firstName} ${reservation.passenger.lastName}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Nr Dokumentu</label>
                                    <div class="value">${reservation.passenger.documentNumber}</div>
                                </div>
                            </div>
                            <div>
                                <div class="bp-field">
                                    <label>Nr Rezerwacji</label>
                                    <div class="value">${reservation.id}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Nr Karty Pok≈Çadowej</label>
                                    <div class="value">${reservation.checkInData.boardingPass}</div>
                                </div>
                            </div>
                        </div>

                        <div class="bp-section">
                            <div>
                                <div class="bp-field">
                                    <label>Z</label>
                                    <div class="value">${flight.departure}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Data</label>
                                    <div class="value">${formatDate(flight.date)}</div>
                                </div>
                            </div>
                            <div>
                                <div class="bp-field">
                                    <label>Do</label>
                                    <div class="value">${flight.arrival}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Lot</label>
                                    <div class="value">${flight.number}</div>
                                </div>
                            </div>
                        </div>

                        <div class="bp-section">
                            <div>
                                <div class="bp-field">
                                    <label>Boarding</label>
                                    <div class="value">${boardingTime.toTimeString().substring(0,5)}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Bramka</label>
                                    <div class="value">${flight.gate || 'N/A'}</div>
                                </div>
                            </div>
                            <div>
                                <div class="bp-field">
                                    <label>Wylot</label>
                                    <div class="value">${flight.departureTime}</div>
                                </div>
                                <div class="bp-field">
                                    <label>Baga≈º</label>
                                    <div class="value">${reservation.checkInData.luggage} kg</div>
                                </div>
                            </div>
                        </div>

                        <div class="bp-large">
                            <div class="bp-field">
                                <label>Miejsce</label>
                                <div class="seat">${reservation.checkInData.seat}</div>
                            </div>
                        </div>

                        <div class="bp-barcode">
                            <div id="qrcode-${reservation.checkInData.boardingPass}"></div>
                            <div class="barcode-text">${reservation.checkInData.boardingPass}</div>
                        </div>

                        <div style="text-align:center; padding:20px; color:#666; font-size:0.9em;">
                            <p>Prosimy o przybycie do bramki minimum 30 minut przed odlotem</p>
                            <p>Boarding zamyka siƒô 15 minut przed startem</p>
                        </div>
                    </div>
                </div>
                <div style="text-align:center; margin:20px;">
                    <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Drukuj Kartƒô Pok≈ÇadowƒÖ</button>
                    <button class="btn btn-success" onclick="finishCheckin()">‚úÖ Zako≈Ñcz i Wr√≥ƒá</button>
                </div>
            `;

            document.getElementById('checkinFormContainer').style.display = 'none';
            container.style.display = 'block';

            // Generuj QR kod
            setTimeout(() => {
                const qrContainer = document.getElementById(`qrcode-${reservation.checkInData.boardingPass}`);
                if (qrContainer && typeof QRCode !== 'undefined') {
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: reservation.checkInData.boardingPass,
                        width: 200,
                        height: 200,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }, 100);
        }

        function finishCheckin() {
            document.getElementById('searchCheckin').value = '';
            document.getElementById('checkinSearchResults').innerHTML = '';
            document.getElementById('boardingPassContainer').style.display = 'none';
            currentCheckinReservation = null;
            showNotification('‚úÖ Odprawa zako≈Ñczona pomy≈õlnie!', 'success');
        }

        // Wpuszczanie na pok≈Çad - skanowanie QR
        function scanBoardingPass() {
            const qrCode = document.getElementById('qrCodeInput').value.trim();
            
            if (!qrCode) {
                showNotification('‚ö†Ô∏è Wprowad≈∫ kod z karty pok≈Çadowej!', 'error');
                return;
            }

            // Znajd≈∫ rezerwacjƒô po kodzie karty pok≈Çadowej
            const reservation = reservations.find(r => 
                r.checkedIn && r.checkInData && r.checkInData.boardingPass === qrCode
            );

            const resultContainer = document.getElementById('scanResult');
            
            if (!reservation) {
                resultContainer.style.display = 'block';
                resultContainer.innerHTML = `
                    <div class="scan-error">
                        <h2 style="font-size:3em; margin-bottom:20px;">‚ùå</h2>
                        <h3 style="font-size:2em; margin-bottom:10px;">DOSTƒòP ZABRONIONY</h3>
                        <p style="font-size:1.3em;">Karta pok≈Çadowa nie zosta≈Ça znaleziona w systemie</p>
                        <p style="margin-top:20px;">Kod: ${qrCode}</p>
                    </div>
                `;
                showNotification('‚ùå Nieprawid≈Çowa karta pok≈Çadowa!', 'error');
                document.getElementById('qrCodeInput').value = '';
                
                // D≈∫wiƒôk b≈Çƒôdu (opcjonalnie)
                playErrorSound();
                return;
            }

            const flight = flights.find(f => f.id === reservation.flightId);
            const now = new Date();
            const flightDate = new Date(flight.date + ' ' + flight.departureTime);
            const boardingTime = new Date(flightDate);
            boardingTime.setMinutes(boardingTime.getMinutes() - 30);

            resultContainer.style.display = 'block';
            resultContainer.innerHTML = `
                <div class="scan-success">
                    <h2 style="font-size:3em; margin-bottom:20px;">‚úÖ</h2>
                    <h3 style="font-size:2em; margin-bottom:10px;">DOSTƒòP PRZYZNANY</h3>
                    <p style="font-size:1.3em;">Pasa≈ºer mo≈ºe wej≈õƒá na pok≈Çad</p>
                </div>

                <div class="passenger-details">
                    <h3 style="color:#28a745; margin-bottom:20px; text-align:center;">Dane Pasa≈ºera</h3>
                    
                    <div class="detail-row">
                        <span class="detail-label">Imiƒô i Nazwisko:</span>
                        <span class="detail-value">${reservation.passenger.firstName} ${reservation.passenger.lastName}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Nr Dokumentu:</span>
                        <span class="detail-value">${reservation.passenger.documentNumber}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Data Urodzenia:</span>
                        <span class="detail-value">${formatDate(reservation.passenger.birthDate)}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Nr Rezerwacji:</span>
                        <span class="detail-value">${reservation.id}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Nr Karty Pok≈Çadowej:</span>
                        <span class="detail-value">${reservation.checkInData.boardingPass}</span>
                    </div>

                    <hr style="margin:20px 0; border:none; border-top:2px solid #e0e0e0;">
                    
                    <h3 style="color:#28a745; margin-bottom:20px; text-align:center;">Informacje o Locie</h3>
                    
                    <div class="detail-row">
                        <span class="detail-label">Numer Lotu:</span>
                        <span class="detail-value">${flight.number}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Linia Lotnicza:</span>
                        <span class="detail-value">${flight.airline}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Z:</span>
                        <span class="detail-value">${flight.departure}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Do:</span>
                        <span class="detail-value">${flight.arrival}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Data Lotu:</span>
                        <span class="detail-value">${formatDate(flight.date)}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Wylot:</span>
                        <span class="detail-value">${flight.departureTime}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Bramka:</span>
                        <span class="detail-value" style="font-size:1.5em; color:#1e3c72;">${flight.gate || 'Nie przypisana'}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Miejsce:</span>
                        <span class="detail-value" style="font-size:1.5em; color:#1e3c72;">${reservation.checkInData.seat}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Baga≈º:</span>
                        <span class="detail-value">${reservation.checkInData.luggage} kg</span>
                    </div>
                </div>

                <button class="btn btn-success" onclick="confirmBoarding()" style="width:100%; font-size:1.2em; padding:15px; margin-top:20px;">
                    ‚úÖ Potwierd≈∫ Wej≈õcie na Pok≈Çad
                </button>
            `;

            showNotification('‚úÖ Karta pok≈Çadowa zweryfikowana pomy≈õlnie!', 'success');
            document.getElementById('qrCodeInput').value = '';
            
            // D≈∫wiƒôk sukcesu (opcjonalnie)
            playSuccessSound();
        }

        function confirmBoarding() {
            document.getElementById('scanResult').style.display = 'none';
            document.getElementById('qrCodeInput').value = '';
            showNotification('‚úÖ Pasa≈ºer wpuszczony na pok≈Çad!', 'success');
        }

        // Opcjonalne d≈∫wiƒôki
        function playSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playErrorSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 200;
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Funkcje pomocnicze
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function getStatusBadge(status) {
            const badges = {
                'scheduled': '<span class="badge badge-info">Zaplanowany</span>',
                'boarding': '<span class="badge badge-success">Boarding</span>',
                'delayed': '<span class="badge badge-warning">Op√≥≈∫niony</span>',
                'cancelled': '<span class="badge badge-danger">Odwo≈Çany</span>',
                'departed': '<span class="badge badge-success">Wylecia≈Ç</span>'
            };
            return badges[status] || '<span class="badge badge-info">Nieznany</span>';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pl-PL');
        }

        // Inicjalizacja
        init();

        // Obs≈Çuga Enter w polu skanowania
        document.getElementById('qrCodeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                scanBoardingPass();
            }
        });
    </script>
</body>
</html>